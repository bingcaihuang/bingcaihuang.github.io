<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="BingcaiHuang&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="BingcaiHuang&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BingcaiHuang&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>BingcaiHuang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BingcaiHuang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/01/C-新特性学习/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BingcaiHuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BingcaiHuang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/01/C-新特性学习/" itemprop="url">C++新特性学习</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-01T17:09:33+08:00">
                2018-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C++</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/08/01/C-新特性学习/" class="leancloud_visitors" data-flag-title="C++新特性学习">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="C-新特性学习"><a href="#C-新特性学习" class="headerlink" title="C++新特性学习"></a>C++新特性学习</h2><h3 id="c-Lambda表达式"><a href="#c-Lambda表达式" class="headerlink" title="c++ Lambda表达式"></a>c++ Lambda表达式</h3><blockquote>
<p><a href="https://www.cnblogs.com/jin521/p/5710559.html" target="_blank" rel="noopener">c++ Lambda表达式待修改</a></p>
</blockquote>
<p>C++11引入了lambda表达式，使得程序员可以定义匿名函数，该函数是一次性执行的，既方便了编程，又能防止别人的访问。<br>Lambda表达式的语法通过下图来介绍：</p>
<p><img src="/2018/08/01/C-新特性学习/1533114695717.png" alt=""></p>
<p>这里假设我们定义了一个如上图的lambda表达式。现在来介绍途中标有编号的各个部分是什么意思。</p>
<ol>
<li>Lambda表达式的引入标志，在‘[]’里面可以填入‘=’或‘&amp;’表示该lambda表达式“捕获”（lambda表达式在一定的scope可以访问的数据）的数据时以什么方式捕获的，‘&amp;’表示一引用的方式；‘=’表明以值传递的方式捕获，除非专门指出。</li>
<li>Lambda表达式的参数列表</li>
<li>Mutable 标识</li>
<li>异常标识</li>
<li>返回值</li>
<li>“函数”体，也就是lambda表达式需要进行的实际操作</li>
</ol>
<p>将上图的代码片段补充完整：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">int x = 10;</span><br><span class="line">int y = 3;</span><br><span class="line">int z ;</span><br><span class="line">z = [=]()mutable throw() -&gt; int &#123; int n = x + y; x = y ; y = n; return n;&#125;();</span><br><span class="line">cout&lt;&lt;z&lt;&lt;endl;</span><br><span class="line">cout&lt;&lt;&quot;x:&quot;&lt;&lt;x&lt;&lt;&quot;\t&quot;&lt;&lt;&quot;y:&quot;&lt;&lt;y&lt;&lt;endl;</span><br></pre></td></tr></table></figure>
<h3 id="std-function的用法"><a href="#std-function的用法" class="headerlink" title="std::function的用法"></a>std::function的用法</h3><blockquote>
<p><a href="https://blog.csdn.net/zeqi1991/article/details/73727458?locationNum=8&amp;fps=1" target="_blank" rel="noopener">std::function的用法</a></p>
</blockquote>
<p>类模版<code>std::function</code>是一种通用、多态的函数封装。<code>std::function</code>的实例可以对任何可以调用的目标实体进行存储、复制、和调用操作，这些目标实体包括普通函数、Lambda表达式、函数指针、以及其它函数对象等。<code>std::function</code>对象是对C++中现有的可调用实体的一种类型安全的包裹（我们知道像函数指针这类可调用实体，是类型不安全的）。</p>
<p>通常<code>std::function</code>是一个函数对象类，它包装其它任意的函数对象，被包装的函数对象具有类型为T1, …,TN的N个参数，并且返回一个可转换到R类型的值。std::function使用 模板转换构造函数接收被包装的函数对象；特别是，闭包类型可以隐式地转换为<code>std::function</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;list&gt;</span><br><span class="line">#include &lt;map&gt;</span><br><span class="line">#include &lt;set&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line">#include &lt;algorithm&gt;</span><br><span class="line">#include &lt;functional&gt;</span><br><span class="line">#include &lt;memory&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">//声明一个模板</span><br><span class="line">typedef std::function&lt;int(int)&gt; Functional;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//normal function</span><br><span class="line">int TestFunc(int a)</span><br><span class="line">&#123;</span><br><span class="line">    return a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//lambda expression</span><br><span class="line">auto lambda = [](int a)-&gt;int&#123;return a;&#125;;</span><br><span class="line"></span><br><span class="line">//functor仿函数</span><br><span class="line">class Functor</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    int operator() (int a)</span><br><span class="line">    &#123;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//类的成员函数和类的静态成员函数</span><br><span class="line">class CTest</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    int Func(int a)</span><br><span class="line">    &#123;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">    static int SFunc(int a)</span><br><span class="line">    &#123;</span><br><span class="line">        return a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    //封装普通函数</span><br><span class="line">    Functional obj = TestFunc;</span><br><span class="line">    int res = obj(0);</span><br><span class="line">    cout &lt;&lt; &quot;normal function : &quot; &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //封装lambda表达式</span><br><span class="line">    obj = lambda;</span><br><span class="line">    res = obj(1);</span><br><span class="line">    cout &lt;&lt; &quot;lambda expression : &quot; &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //封装仿函数</span><br><span class="line">    Functor functorObj;</span><br><span class="line">    obj = functorObj;</span><br><span class="line">    res = obj(2);</span><br><span class="line">    cout &lt;&lt; &quot;functor : &quot; &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    //封装类的成员函数和static成员函数</span><br><span class="line">    CTest t;</span><br><span class="line">    obj = std::bind(&amp;CTest::Func, &amp;t, std::placeholders::_1);</span><br><span class="line">    res = obj(3);</span><br><span class="line">    cout &lt;&lt; &quot;member function : &quot; &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    obj = CTest::SFunc;</span><br><span class="line">    res = obj(4);</span><br><span class="line">    cout &lt;&lt; &quot;static member function : &quot; &lt;&lt; res &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/2018/08/01/C-新特性学习/1533114713752.png" alt=""></p>
<p>对于各个可调用实体转换成std::function类型的对象，上面的代码都有，运行一下代码，阅读一下上面那段简单的代码。总结了简单的用法以后，来看看一些需要注意的事项：</p>
<ul>
<li>关于可调用实体转换为<code>std::function</code>对象需要遵守以下两条原则：<ul>
<li>转换后的<code>std::function</code>对象的参数能转换为可调用实体的参数；</li>
<li>可调用实体的返回值能转换为<code>std::function</code>对象的返回值。</li>
</ul>
</li>
<li><code>std::function</code>对象最大的用处就是在实现函数回调，使用者需要注意，它不能被用来检查相等或者不相等，但是可以与NULL或者nullptr进行比较。</li>
</ul>
<p><strong>为什么要用std::function</strong><br>好用并实用的东西才会加入标准的。因为好用，实用，我们才在项目中使用它。std::function实现了一套类型消除机制，可以统一处理不同的函数对象类型。以前我们使用函数指针来完成这些；现在我们可以使用更安全的std::function来完成这些任务。</p>
<h3 id="C-11新特性之-CALLBACKS"><a href="#C-11新特性之-CALLBACKS" class="headerlink" title="C++11新特性之 CALLBACKS"></a>C++11新特性之 CALLBACKS</h3><blockquote>
<p>文章链接：<a href="https://blog.csdn.net/wangshubo1989/article/details/49644543" target="_blank" rel="noopener">C++11新特性之 CALLBACKS</a></p>
</blockquote>
<h4 id="使用回调"><a href="#使用回调" class="headerlink" title="使用回调"></a>使用回调</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">namespace &#123;</span><br><span class="line">using cb1_t = std::function&lt;void()&gt;;</span><br><span class="line">using cb2_t = std::function&lt;void(int)&gt;;</span><br><span class="line"></span><br><span class="line">void foo1()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;foo1 is called\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo2(int i)</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;foo2 is called with: &quot; &lt;&lt; i &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct S &#123;</span><br><span class="line">    void foo3()</span><br><span class="line">    &#123;</span><br><span class="line">        std::cout &lt;&lt; &quot;foo3 is called.\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    // Bind a free function.</span><br><span class="line">    cb1_t f1 = std::bind(&amp;foo1);</span><br><span class="line">    // Invoke the function foo1.</span><br><span class="line">    f1();</span><br><span class="line"></span><br><span class="line">    // Bind a free function with an int argument.</span><br><span class="line">    // Note that the argument can be specified with bind directly.</span><br><span class="line">    cb1_t f2 = std::bind(&amp;foo2, 5);</span><br><span class="line">    // Invoke the function foo2.</span><br><span class="line">    f2();</span><br><span class="line"></span><br><span class="line">    // Bind a function with a placeholder.</span><br><span class="line">    cb2_t f3 = std::bind(&amp;foo2, std::placeholders::_1);</span><br><span class="line">    // Invoke the function with an argument.</span><br><span class="line">    f3(42);</span><br><span class="line"></span><br><span class="line">    // Bind a member function.</span><br><span class="line">    S s;</span><br><span class="line">    cb1_t   f4 = std::bind(&amp;S::foo3, &amp;s);</span><br><span class="line">    // Invoke the method foo3.</span><br><span class="line">    f4();</span><br><span class="line"></span><br><span class="line">    // Bind a lambda.</span><br><span class="line">    cb1_t f5 = std::bind([] &#123; std::cout &lt;&lt; &quot;lambda is called\n&quot;; &#125;);</span><br><span class="line">    f5();</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="存储回调"><a href="#存储回调" class="headerlink" title="存储回调"></a>存储回调</h4><p>使用回调是非常好的，但是更多的情况下，我们往往需要存储一些回调函数，并稍后使用。例如，注册一个客户端到某个事件上。（也许注册和事件是C Sharp的词汇）</p>
<p>我们经常使用std::vector来完成任务。<br>缺点就是，我们不能再vector中存储不同的类型 。<br>但是，大多数情况下，一种类型就可以满足我们了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;vector&gt;</span><br><span class="line">#include &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">namespace &#123;</span><br><span class="line"></span><br><span class="line">using cb1_t = std::function&lt;void()&gt;;</span><br><span class="line">using callbacks_t = std::vector&lt;cb1_t&gt;;</span><br><span class="line"></span><br><span class="line">callbacks_t callbacks;</span><br><span class="line"></span><br><span class="line">void foo1()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;foo1 is called\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo2(int i)</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;foo2 is called with: &quot; &lt;&lt; i &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; // end anonymous namespace</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    // Bind a free function.</span><br><span class="line">    cb1_t f1 = std::bind(&amp;foo1);</span><br><span class="line">    callbacks.push_back(f1);</span><br><span class="line"></span><br><span class="line">    // Bind a free function with an int argument.</span><br><span class="line">    // Here the argument is statically known.</span><br><span class="line">    cb1_t f2 = std::bind(&amp;foo2, 5);</span><br><span class="line">    callbacks.push_back(f2);</span><br><span class="line"></span><br><span class="line">    // Bind a free function with an int argument.</span><br><span class="line">    // Here the argument is bound and can be changed at runtime.</span><br><span class="line">    int n = 15;</span><br><span class="line">    cb1_t f3 = std::bind(&amp;foo2, std::cref(n));</span><br><span class="line">    callbacks.push_back(f3);</span><br><span class="line"></span><br><span class="line">    // Invoke the functions</span><br><span class="line">    for(auto&amp; fun : callbacks) &#123;</span><br><span class="line">        fun();</span><br><span class="line">    &#125;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="包装函数"><a href="#包装函数" class="headerlink" title="包装函数"></a>包装函数</h4><p>上面提到都不是重点，个人觉得特别重要的就是std::function作为函数的参数使用。<br>下面一个例子就将展示一个函数被copy不同的参数。</p>
<p>Note that we always produce an std::function, even though in some cases we could invoke the target directly. Whether this is required depends on the use case. If all the function does is invoking the target, then directly doing it is more efficient. The reason is that std::function does have some overhead, because it is a polymorphic class.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;functional&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line"></span><br><span class="line">namespace &#123;</span><br><span class="line"></span><br><span class="line">using cb1_t = std::function&lt;void()&gt;;</span><br><span class="line">using cb2_t = std::function&lt;void(int)&gt;;</span><br><span class="line"></span><br><span class="line">// Wrapper function with std::function without arguments.</span><br><span class="line">template&lt;typename R&gt;</span><br><span class="line">void call(std::function&lt;R(void)&gt; f)</span><br><span class="line">&#123;</span><br><span class="line">    f();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Wrapper function with std::function with arguments.</span><br><span class="line">template&lt;typename R, typename ...A&gt;</span><br><span class="line">void call(std::function&lt;R(A...)&gt; f, A... args)</span><br><span class="line">&#123;</span><br><span class="line">    f(args...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Wrapper function for generic callable object without arguments.</span><br><span class="line">// Delegates to the std::function call.</span><br><span class="line">template&lt;typename R&gt;</span><br><span class="line">void call(R f(void))</span><br><span class="line">&#123;</span><br><span class="line">    call(std::function&lt;R(void)&gt;(f));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Wrapper function for generic callable object with arguments.</span><br><span class="line">// Delegates to the std::function call.</span><br><span class="line">template&lt;typename R, typename ...A&gt;</span><br><span class="line">void call(R f(A...), A... args)</span><br><span class="line">&#123;</span><br><span class="line">    call(std::function&lt;R(A...)&gt;(f), args...);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Wrapper for a function pointer (e.g. a lambda without capture) without</span><br><span class="line">// arguments.</span><br><span class="line">using fp = void (*)(void);</span><br><span class="line">void call(fp f)</span><br><span class="line">&#123;</span><br><span class="line">    call(std::function&lt;void()&gt;(f));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo1()</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;foo1 is called\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void foo2(int i)</span><br><span class="line">&#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;foo2 is called with: &quot; &lt;&lt; i &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; // end anonymous namespace</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    // Call function 1.</span><br><span class="line">    call(&amp;foo1);</span><br><span class="line"></span><br><span class="line">    // Alternative to call function 1.</span><br><span class="line">    cb1_t f1 = std::bind(&amp;foo1);</span><br><span class="line">    call(f1);</span><br><span class="line"></span><br><span class="line">    // Call function 2.</span><br><span class="line">    call(&amp;foo2, 5);</span><br><span class="line"></span><br><span class="line">    // Alternative to call function 2.</span><br><span class="line">    cb2_t f2 = std::bind(&amp;foo2, std::placeholders::_1);</span><br><span class="line">    call(f2, 5);</span><br><span class="line"></span><br><span class="line">    // Here is an example with a lambda. It calls the function that takes a</span><br><span class="line">    // function pointer.</span><br><span class="line">    call([] &#123; std::cout &lt;&lt; &quot;lambda called\n&quot;; &#125;);</span><br><span class="line"></span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="C-11-STL-functional-标准库"><a href="#C-11-STL-functional-标准库" class="headerlink" title="C++ 11 STL | functional 标准库"></a>C++ 11 STL | functional 标准库</h3><blockquote>
<p>文章链接：<a href="https://www.sczyh30.com/posts/C-C/cpp-stl-functional/" target="_blank" rel="noopener">C++ 11 STL | functional 标准库</a></p>
</blockquote>
<p>最近正好用到了这个，就顺便总结下吧。</p>
<p>C++ 11引入了函数对象标准库<functional>，里面包含各种内建的函数对象以及相关的操作函数，非常方便。这里总结一下std::function和std::bind的相关用法。</functional></p>
<h4 id="Callable-type"><a href="#Callable-type" class="headerlink" title="Callable type"></a>Callable type</h4><p>Callable type指可以像调用函数一样被调用的对象或函数，包括：</p>
<ul>
<li>std::function</li>
<li>std::bind</li>
<li>std::result_of</li>
<li>std::thread::thread</li>
<li>std::call_once</li>
<li>std::async</li>
<li>std::packaged_task</li>
<li>std::reference_wrapper</li>
</ul>
<p>根据C++ 17 Standard，所有Callable type都可以通过std::invoke方法进行显式调用。</p>
<h4 id="std-function"><a href="#std-function" class="headerlink" title="std::function"></a>std::function</h4><p><code>std::function</code>类模板是一种通用的函数包装器，它可以容纳所有可以调用的对象（Callable），包括 <strong>函数、函数指针、Lambda表达式、bind表达式、成员函数及成员变量或者其他函数对象</strong>。通过std::function可以储存、拷贝或调用Callable对象。它的模板参数如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">template&lt; class R, class... Args &gt;</span><br><span class="line">class function&lt;R(Args...)&gt;</span><br></pre></td></tr></table></figure></p>
<p>使用时，模板参数与要存储的函数参数一致即可，下面是一些例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;functional&gt;</span><br><span class="line">double f(int x, char y, double z) &#123;</span><br><span class="line">    return x + y + z;</span><br><span class="line">&#125;</span><br><span class="line">void print_num(int num) &#123;</span><br><span class="line">    std::cout &lt;&lt; num &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line">struct Dog &#123;</span><br><span class="line">    int id;</span><br><span class="line">    explicit Dog(int id): id(id) &#123;&#125;</span><br><span class="line">    void print_add(int i) const &#123;</span><br><span class="line">        std::cout &lt;&lt; id + i &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">class PrintString &#123;</span><br><span class="line">public:</span><br><span class="line">    void operator()(std::string&amp;&amp; s) const &#123;</span><br><span class="line">        std::cout &lt;&lt; s &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">int main(int argc, char **argv) &#123;</span><br><span class="line">    // common function</span><br><span class="line">    std::function&lt;void(int)&gt; func_display_num = print_num;</span><br><span class="line">    func_display_num(9);</span><br><span class="line">    // common function</span><br><span class="line">    std::function&lt;double(int, char, double)&gt; func_display = f;</span><br><span class="line">    std::cout &lt;&lt; func_display(3, &apos;a&apos;, 1.7) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">    // lambda expression</span><br><span class="line">    std::function&lt;void(const char*)&gt; lbd_dsp_str = [](const char *s) &#123;std::cout &lt;&lt; s &lt;&lt; std::endl;&#125;;   </span><br><span class="line">    lbd_dsp_str(&quot;Scala&quot;);</span><br><span class="line">    // bind expression</span><br><span class="line">    auto func_num_bind = std::bind(&amp;f, std::placeholders::_1, &apos;c&apos;, 2.4);</span><br><span class="line">    std::cout &lt;&lt; func_num_bind(24) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">    // function object</span><br><span class="line">    std::function&lt;void(std::string&amp;&amp;)&gt; func_obj_print = PrintString();</span><br><span class="line">    func_obj_print(&quot;C++ 17 Nice!&quot;);</span><br><span class="line">    // member function</span><br><span class="line">    const Dog dog(2424);</span><br><span class="line">    std::function&lt;void(const Dog&amp;, int)&gt; func_mem_display_num = &amp;Dog::print_add;</span><br><span class="line">    func_mem_display_num(dog, 24);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意声明时可用 <code>auto</code> 进行自动类型推导，这样可以节约时间，不过这样会牺牲代码的可读性，因此需要根据情况合理使用 <code>auto</code> 。</p>
<h4 id="std-bind"><a href="#std-bind" class="headerlink" title="std::bind"></a>std::bind</h4><p>顾名思义，<code>std::bind</code> 函数用来绑定函数的某些参数并生成一个新的 <code>function</code> 对象。<br> <code>bind</code> 用于实现偏函数（Partial Function），相当于实现了函数式编程中的 Currying（柯里化）。<br>比如有一函数的定义为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void func_muti(int a, std::string&amp;&amp; b, const char* c, double d, char e) &#123;</span><br><span class="line">    std::cout &lt;&lt; a &lt;&lt; &quot;, &quot; &lt;&lt; b &lt;&lt; &quot;, &quot; &lt;&lt; c &lt;&lt; &quot;, &quot; &lt;&lt; d &lt;&lt; &quot;, &quot; &lt;&lt; e &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现在将此函数的一些参数绑定上值，其余部分用占位符对象（std::placeholders）表示。占位符是有序号的，代表调用此函数对象时参数在参数列表中的位置。比如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auto f = std::bind(&amp;func_muti, 24, std::placeholders::_1, &quot;Haha&quot;, std::placeholders::_2, &apos;P&apos;);  </span><br><span class="line">f(&quot;Hehe&quot;, 24.24);</span><br></pre></td></tr></table></figure></p>
<p>调用这个函数对象相当于调用以下函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">void f(std::string&amp;&amp; b, double d) &#123;</span><br><span class="line">    std::cout &lt;&lt; &quot;24&quot; &lt;&lt; &quot;, &quot; &lt;&lt; b &lt;&lt; &quot;, &quot; &lt;&lt; &quot;Haha&quot; &lt;&lt; &quot;, &quot; &lt;&lt; d &lt;&lt; &quot;, &quot; &lt;&lt; &apos;P&apos; &lt;&lt; &quot;\n&quot;;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/31/SQLite中的自增关键字：AUTO-INCREMENT、INTEGER-PRIMARY-KEY与AUTOINCREMENT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BingcaiHuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BingcaiHuang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/31/SQLite中的自增关键字：AUTO-INCREMENT、INTEGER-PRIMARY-KEY与AUTOINCREMENT/" itemprop="url">SQLite中的自增关键字：AUTO_INCREMENT、INTEGER PRIMARY KEY与AUTOINCREMENT</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-31T09:39:32+08:00">
                2018-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/SQL/" itemprop="url" rel="index">
                    <span itemprop="name">SQL</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/07/31/SQLite中的自增关键字：AUTO-INCREMENT、INTEGER-PRIMARY-KEY与AUTOINCREMENT/" class="leancloud_visitors" data-flag-title="SQLite中的自增关键字：AUTO_INCREMENT、INTEGER PRIMARY KEY与AUTOINCREMENT">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="SQLite中的自增关键字：AUTO-INCREMENT、INTEGER-PRIMARY-KEY与AUTOINCREMENT"><a href="#SQLite中的自增关键字：AUTO-INCREMENT、INTEGER-PRIMARY-KEY与AUTOINCREMENT" class="headerlink" title="SQLite中的自增关键字：AUTO_INCREMENT、INTEGER PRIMARY KEY与AUTOINCREMENT"></a>SQLite中的自增关键字：AUTO_INCREMENT、INTEGER PRIMARY KEY与AUTOINCREMENT</h2><blockquote>
<p>参考文章：<a href="https://www.cnblogs.com/russellluo/p/3186786.html" target="_blank" rel="noopener">SQLite中的自增关键字：AUTO_INCREMENT、INTEGER PRIMARY KEY与AUTOINCREMENT</a></p>
</blockquote>
<h3 id="SQLite不支持关键字AUTO-INCREMENT"><a href="#SQLite不支持关键字AUTO-INCREMENT" class="headerlink" title="SQLite不支持关键字AUTO_INCREMENT"></a>SQLite不支持关键字AUTO_INCREMENT</h3><h4 id="AUTO-INCREMENT不生效的问题"><a href="#AUTO-INCREMENT不生效的问题" class="headerlink" title="AUTO_INCREMENT不生效的问题"></a>AUTO_INCREMENT不生效的问题</h4><p>SQL语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER AUTO_INCREMENT,</span><br><span class="line">    title TEXT,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>问题描述：按照上述SQL语句创建表todo，用INSERT INTO todo (title) VALUES (‘xxx’)插入记录，但查询该记录后得到的id为NULL（即Python中的None）</p>
<p>实验脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- encoding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import sqlite3</span><br><span class="line">con = sqlite3.connect(&quot;:memory:&quot;)</span><br><span class="line"></span><br><span class="line"># 创建表</span><br><span class="line">con.execute(&quot;&quot;&quot;</span><br><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER AUTO_INCREMENT,</span><br><span class="line">    title TEXT,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">);&quot;&quot;&quot;)</span><br><span class="line"></span><br><span class="line"># 插入记录</span><br><span class="line">con.execute(&quot;INSERT INTO todo (title) VALUES (&apos;shopping&apos;);&quot;)</span><br><span class="line"></span><br><span class="line"># 查询记录</span><br><span class="line">for row in con.execute(&quot;SELECT * FROM todo&quot;):</span><br><span class="line">    print row</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python auto_increment_null.py</span><br><span class="line">(None, u&apos;shopping&apos;)</span><br></pre></td></tr></table></figure></p>
<h4 id="AUTO-INCREMENT导致语法错误的问题"><a href="#AUTO-INCREMENT导致语法错误的问题" class="headerlink" title="AUTO_INCREMENT导致语法错误的问题"></a>AUTO_INCREMENT导致语法错误的问题</h4><p>SQL语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    title TEXT</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>问题描述：根据SQL的语法，<strong>按理说上述SQL语句应该与1）中的SQL语句等效</strong>，但运行结果却是语法错误</p>
<p>实验脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- encoding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import sqlite3</span><br><span class="line">con = sqlite3.connect(&quot;:memory:&quot;)</span><br><span class="line"></span><br><span class="line"># 创建表</span><br><span class="line">con.execute(&quot;&quot;&quot;</span><br><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">    title TEXT</span><br><span class="line">);&quot;&quot;&quot;)</span><br><span class="line"></span><br><span class="line"># 插入记录</span><br><span class="line">con.execute(&quot;INSERT INTO todo (title) VALUES (&apos;shopping&apos;);&quot;)</span><br><span class="line"></span><br><span class="line"># 查询记录</span><br><span class="line">for row in con.execute(&quot;SELECT * FROM todo&quot;):</span><br><span class="line">    print row</span><br></pre></td></tr></table></figure></p>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python auto_increment_error.py</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;auto_increment_error.py&quot;, line 14, in &lt;module&gt;</span><br><span class="line">    );&quot;&quot;&quot;)</span><br><span class="line">sqlite3.OperationalError: near &quot;AUTO_INCREMENT&quot;: syntax error</span><br></pre></td></tr></table></figure>
<p>上述两个问题在<a href="http://stackoverflow.com/questions/508627/auto-increment-in-sqlite-problem-with-python" target="_blank" rel="noopener">《AUTO_INCREMENT in sqlite problem with python》</a>中得到了解释和解答：在SQLite中，自增字段需要使用关键字INTEGER PRIMARY KEY。</p>
<h3 id="自增关键字INTEGER-PRIMARY-KEY"><a href="#自增关键字INTEGER-PRIMARY-KEY" class="headerlink" title="自增关键字INTEGER PRIMARY KEY"></a>自增关键字INTEGER PRIMARY KEY</h3><p>SQL语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY,</span><br><span class="line">    title TEXT</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>或者<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY NOT NULL,</span><br><span class="line">    title TEXT</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>按照上述SQL语句创建表todo，用INSERT INTO todo (title) VALUES (‘xxx’)或者INSERT INTO todo (id, title) VALUES (NULL, ‘xxx’)插入记录，查询记录后得到的id为自增的整型值。</p>
<p>实验脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- encoding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import sqlite3</span><br><span class="line">con = sqlite3.connect(&quot;:memory:&quot;)</span><br><span class="line"></span><br><span class="line"># 创建表</span><br><span class="line">con.execute(&quot;&quot;&quot;</span><br><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY,</span><br><span class="line">    title TEXT</span><br><span class="line">);&quot;&quot;&quot;)</span><br><span class="line"></span><br><span class="line"># 创建表：效果相同</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">con.execute(&quot;&quot;&quot;</span><br><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY NOT NULL,</span><br><span class="line">    title TEXT</span><br><span class="line">);&quot;&quot;&quot;)</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line"></span><br><span class="line"># 插入记录：shopping</span><br><span class="line">con.execute(&quot;INSERT INTO todo (title) VALUES (&apos;shopping&apos;);&quot;)</span><br><span class="line"></span><br><span class="line"># 插入记录：working</span><br><span class="line">con.execute(&quot;INSERT INTO todo (id, title) VALUES (NULL, &apos;working&apos;);&quot;)</span><br><span class="line"></span><br><span class="line"># 查询记录</span><br><span class="line">for row in con.execute(&quot;SELECT * FROM todo&quot;):</span><br><span class="line">    print row</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python integer_primary_key_ok.py</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(2, u&apos;working&apos;)</span><br></pre></td></tr></table></figure></p>
<p>注意：之前看<a href="http://stackoverflow.com/questions/11490100/no-autoincrement-for-integer-primary-key-in-sqlite3" target="_blank" rel="noopener">《No autoincrement for Integer Primary key in sqlite3》</a>中有提到“SQLite的自增字段定义为NULL或NOT NULL是有区别的”，根据上面的实验，这个问题好像已经不存在了。</p>
<h3 id="关键字AUTOINCREMENT与内部表sqlite-sequence"><a href="#关键字AUTOINCREMENT与内部表sqlite-sequence" class="headerlink" title="关键字AUTOINCREMENT与内部表sqlite_sequence"></a>关键字AUTOINCREMENT与内部表sqlite_sequence</h3><p>SQLite中，在INTEGER PRIMARY KEY的基础上添加AUTOINCREMENT后（即INTEGER PRIMARY KEY AUTOINCREMENT），可以在表的整个生命周期内保证“自增字段”的唯一性（create keys that are unique over the lifetime of the table）。</p>
<p>SQLite内部用一个叫作sqlite_sequence的表来保存所有表的自增字段的取值基准（the largest ROWID），如果清空sqlite_sequence的记录，可以实现将所有表的自增字段的取值归零的效果（这种行为具有破坏性，请谨慎使用）。</p>
<p>关于这一主题，更详细的介绍可以参考<a href="http://www.sqlite.org/faq.html#q1" target="_blank" rel="noopener">《How do I create an AUTOINCREMENT field》</a>和<a href="http://www.sqlite.org/autoinc.html" target="_blank" rel="noopener">《SQLite Autoincrement》</a></p>
<p>实验脚本：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"># -*- encoding: utf-8 -*-</span><br><span class="line"></span><br><span class="line">import sqlite3</span><br><span class="line">con = sqlite3.connect(&quot;:memory:&quot;)</span><br><span class="line"></span><br><span class="line">def new_and_show(tbl_name):</span><br><span class="line">    &quot;&quot;&quot;插入并显示记录&quot;&quot;&quot;</span><br><span class="line">    # 插入记录到表</span><br><span class="line">    con.execute(&quot;INSERT INTO &quot; + tbl_name + &quot; (title) VALUES (&apos;shopping&apos;);&quot;)</span><br><span class="line">    # 查询表记录</span><br><span class="line">    for row in con.execute(&quot;SELECT * FROM &quot; + tbl_name):</span><br><span class="line">        print row</span><br><span class="line"></span><br><span class="line">def clr(tbl_name):</span><br><span class="line">    &quot;&quot;&quot;清除表记录&quot;&quot;&quot;</span><br><span class="line">    con.execute(&quot;DELETE FROM &quot; + tbl_name)</span><br><span class="line"></span><br><span class="line">print &quot;--表todo--&quot;</span><br><span class="line"># 1. 创建表</span><br><span class="line">con.execute(&quot;&quot;&quot;</span><br><span class="line">CREATE TABLE todo</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY,</span><br><span class="line">    title TEXT</span><br><span class="line">);&quot;&quot;&quot;)</span><br><span class="line"># 2. 插入并显示记录</span><br><span class="line">new_and_show(&quot;todo&quot;)</span><br><span class="line"># 3. 清除表记录</span><br><span class="line">clr(&quot;todo&quot;)</span><br><span class="line"># 4. 插入并显示记录</span><br><span class="line">new_and_show(&quot;todo&quot;)</span><br><span class="line"># 5. 清除表记录</span><br><span class="line">clr(&quot;todo&quot;)</span><br><span class="line"># 6. 插入并显示记录</span><br><span class="line">new_and_show(&quot;todo&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print &quot;--表todo_auto--&quot;</span><br><span class="line"># 1. 创建表</span><br><span class="line">con.execute(&quot;&quot;&quot;</span><br><span class="line">CREATE TABLE todo_auto</span><br><span class="line">(</span><br><span class="line">    id INTEGER PRIMARY KEY AUTOINCREMENT,</span><br><span class="line">    title TEXT</span><br><span class="line">);&quot;&quot;&quot;)</span><br><span class="line"># 2. 插入并显示记录</span><br><span class="line">new_and_show(&quot;todo_auto&quot;)</span><br><span class="line"># 3. 清除表记录</span><br><span class="line">clr(&quot;todo_auto&quot;)</span><br><span class="line"># 4. 插入并显示记录</span><br><span class="line">new_and_show(&quot;todo_auto&quot;)</span><br><span class="line"></span><br><span class="line"># 将所有表的自增列都归零</span><br><span class="line">#clr(&quot;sqlite_sequence&quot;)</span><br><span class="line"></span><br><span class="line"># 5. 清除表记录</span><br><span class="line">clr(&quot;todo_auto&quot;)</span><br><span class="line"># 6. 插入并显示记录</span><br><span class="line">new_and_show(&quot;todo_auto&quot;)</span><br></pre></td></tr></table></figure></p>
<p>运行结果：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ python autoincrement_diff.py</span><br><span class="line">--表todo--</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">--表todo_auto--</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(2, u&apos;shopping&apos;)</span><br><span class="line">(3, u&apos;shopping&apos;)</span><br></pre></td></tr></table></figure></p>
<p>如果去掉clr(“sqlite_sequence”)这一行的注释，则运行结果会变成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ python autoincrement_diff.py</span><br><span class="line">--表todo--</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">--表todo_auto--</span><br><span class="line">(1, u&apos;shopping&apos;)</span><br><span class="line">(2, u&apos;shopping&apos;)</span><br><span class="line">(1, u&apos;shopping&apos;)    ## 由于clr(&quot;sqlite_sequence&quot;)将表todo_auto的自增字段的取值归零，因此这一行又变成了1</span><br></pre></td></tr></table></figure></p>
<p>另外，SQLite不支持SQL标准语句“TRUNCATE TABLE tbl_name”，只能使用“DELETE FROM tbl_name”来删除表记录，具体可以参考<a href="http://zhuyanfeng.com/archives/516" target="_blank" rel="noopener">《SQLite清空表并将自增列归零》</a> 。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/31/Hexo博客添加搜索功能/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BingcaiHuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BingcaiHuang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/31/Hexo博客添加搜索功能/" itemprop="url">Hexo博客添加搜索功能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-31T08:55:20+08:00">
                2018-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/博客搭建教程/" itemprop="url" rel="index">
                    <span itemprop="name">博客搭建教程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/07/31/Hexo博客添加搜索功能/" class="leancloud_visitors" data-flag-title="Hexo博客添加搜索功能">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Hexo博客添加搜索功能"><a href="#Hexo博客添加搜索功能" class="headerlink" title="Hexo博客添加搜索功能"></a>Hexo博客添加搜索功能</h2><blockquote>
<p>参考文章：<a href="http://www.itfanr.cc/2017/10/27/add-search-function-to-hexo-blog/" target="_blank" rel="noopener">Hexo博客添加搜索功能</a></p>
</blockquote>
<p>渐渐的随着hexo博客中文章越来越多了之后,平时想要查找一篇文章时,一般都是记得部分标题内容或者某些关键词,而在”归档”下通过标题一页一页的找又非常的麻烦.所以考虑为博客增加搜索功能.</p>
<p>从Next主题网站上我们可以搜索多款搜索插件<a href="http://theme-next.iissnan.com/third-party-services.html#search-system" target="_blank" rel="noopener">第三方服务集成 – Next文档</a>,个人感觉 “Local Search” 和 “Algolia” 这两款搜索插件比较和我的心意.</p>
<p>下面简要的介绍为hexo博客添加搜索插件的过程.  </p>
<h3 id="升级Next主题版本"><a href="#升级Next主题版本" class="headerlink" title="升级Next主题版本"></a>升级Next主题版本</h3><p>我的hexo主题安装的是 Next 主题,当前版本为 v5.0.1 .最新版本为 5.1.3.</p>
<p>因为我的hexo主题版本差距太大,而且我在 <code>next</code> 主题目录下的 <code>.git</code> 目录我已经删除了,所以我采用完全更新的方式.</p>
<p>先备份本地的 <code>hexo</code> 主题目录 <code>your-hexo-site/themes/next</code> ,其实只需要备份 <code>_config.yml</code> 一个文件即可,为了保险这里我将整个目录都备份一下.</p>
<p>另外还要注意如果你之前添加了自定义头像及打赏功能等所需图片,添加的图片是在 /themes/next/source/images/ 目录下的,也要记得做好备份.</p>
<hr>
<p>如果你本地的主题 <code>next</code> 目录下的 <code>.git</code> 目录没有删除,你可以直接通过 <code>git pull</code> 命令来更新:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd themes/next</span><br><span class="line">$ git pull</span><br></pre></td></tr></table></figure></p>
<h3 id="完全更新"><a href="#完全更新" class="headerlink" title="完全更新"></a>完全更新</h3><p>先删除本地现在的 <code>next</code> 主题目录:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd &lt;your-hexo-site&gt;</span><br><span class="line">$ rm -rf ./themes/next</span><br></pre></td></tr></table></figure></p>
<p>从github下载 hexo 主题文件最新版本:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cd &lt;your-hexo-site&gt;</span><br><span class="line">$ git clone https://github.com/iissnan/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure></p>
<p>比照新的主题配置文件<code>_config.yml</code> ,将旧的主题文件中的内容添加到新文件中.</p>
<p>我这里更改的地方有:</p>
<ul>
<li>menu</li>
<li>scheme</li>
<li>social</li>
<li>sidebar</li>
<li>highlight_theme</li>
<li>tencent_analytics</li>
<li>打赏功能 reward_comment wechatpay alipay</li>
<li>站点建立时间 since</li>
</ul>
<p>更改后,清除缓存,然后再查看:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo s -g</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure></p>
<p>打开浏览器,查看页面中是否有错误并修改.</p>
<hr>
<h3 id="LocalSearch搜索"><a href="#LocalSearch搜索" class="headerlink" title="LocalSearch搜索"></a>LocalSearch搜索</h3><p>安装 <code>hexo-generator-searchdb</code>，在站点的根目录下执行以下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure></p>
<p>编辑 <code>站点配置文件</code>，新增以下内容到任意位置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure></p>
<p>编辑 <code>主题配置文件</code>，启用本地搜索功能：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Local search</span><br><span class="line">local_search:</span><br><span class="line">  enable: true</span><br></pre></td></tr></table></figure></p>
<p>然后 重新生成 查看:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo s -g</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure></p>
<p>这样,搜索功能就添加上了.</p>
<hr>
<h3 id="Algolia搜索"><a href="#Algolia搜索" class="headerlink" title="Algolia搜索"></a>Algolia搜索</h3><p>详情可参考官方教程,这里不再详述.</p>
<ul>
<li><a href="http://theme-next.iissnan.com/third-party-services.html#algolia-search" target="_blank" rel="noopener">Algolia – Next文档</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/31/TortoiseGit代码版本还原方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BingcaiHuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BingcaiHuang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/31/TortoiseGit代码版本还原方法/" itemprop="url">TortoiseGit代码版本还原方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-31T08:34:09+08:00">
                2018-07-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TortoiseGit/" itemprop="url" rel="index">
                    <span itemprop="name">TortoiseGit</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/07/31/TortoiseGit代码版本还原方法/" class="leancloud_visitors" data-flag-title="TortoiseGit代码版本还原方法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="TortoiseGit代码版本还原方法"><a href="#TortoiseGit代码版本还原方法" class="headerlink" title="TortoiseGit代码版本还原方法"></a>TortoiseGit代码版本还原方法</h2><blockquote>
<p>参考文章：<a href="https://www.restran.net/2016/02/22/git-recovery/" target="_blank" rel="noopener">Git 代码版本还原方法</a></p>
</blockquote>
<p>在使用 Git 管理自己的代码和资料时，难免会遇到意料之外的事。比如误操作，将当前的分支删除；或者重置到某个版本，然后发现自己想要的代码找不到了；又或者需要还原到之前提交的某个版本，但是那个版本已经被重置过，在历史中找不到了。</p>
<p>忙活了大半天，发现辛苦换来的成果都没了，遇到这种情况几乎是要崩溃的，不过幸好我们还有 Git。</p>
<p>一般情况下，如果在版本的分支历史上，还可以找到想要的那个版本，那通常比较简单，只要选择重置到该版本就可以了。</p>
<p><img src="/2018/07/31/TortoiseGit代码版本还原方法/1532997357859.png" alt=""></p>
<p>重置类型有三种模式可供选择，soft、mixed 和 hard 的区别如下：</p>
<h3 id="soft-不改动工作区和索引"><a href="#soft-不改动工作区和索引" class="headerlink" title="soft 不改动工作区和索引"></a>soft 不改动工作区和索引</h3><p>假设有一些 commits<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">A - B - C (master)</span><br></pre></td></tr></table></figure></p>
<p>HEAD 指向 C， 并且暂存区（stage，或称为 index）matches C.</p>
<p>当使用 <code>git reset --soft B</code> 时，master 和 HEAD 指向 B，但是依然保留了 C 添加跟踪的文件，此时会将这些文件放入暂存区中，显示为已缓存。同时工作区中修改的文件，显示为未缓存。</p>
<h3 id="mixed-保持工作区不变，重置索引"><a href="#mixed-保持工作区不变，重置索引" class="headerlink" title="mixed 保持工作区不变，重置索引"></a>mixed 保持工作区不变，重置索引</h3><p>当使用 <code>git reset --mixed B</code> 时，master 和 HEAD 指向 B，这时候 C 添加跟踪的文件仍然会在，但是会显示为未缓存（不是版本控制），而当前工作目录中的修改内容，仍然会在，显示未缓存的状态</p>
<p>（如果不知道怎么选，默认使用 mixed）</p>
<h3 id="hard-重置索引和工作区（丢弃所有本地变更）"><a href="#hard-重置索引和工作区（丢弃所有本地变更）" class="headerlink" title="hard 重置索引和工作区（丢弃所有本地变更）"></a>hard 重置索引和工作区（丢弃所有本地变更）</h3><p>当使用 <code>git reset --hard B</code> 时，C 添加跟踪的文件，以及当前工作目录中的修改内容，都会丢失。</p>
<hr>
<p>如果比较悲剧，分支历史上已经找不到想要的那个版本的代码了，但是别急，只要是有提交的代码，Git 都能找回来。</p>
<h3 id="命令行操作"><a href="#命令行操作" class="headerlink" title="命令行操作"></a>命令行操作</h3><p>查看引用记录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog</span><br></pre></td></tr></table></figure></p>
<p>会输出类似如下的内容，所有的提交记录都能看到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">22d3349 HEAD@&#123;0&#125;: checkout: moving from develop to master</span><br><span class="line">22d3349 HEAD@&#123;1&#125;: rebase -i (finish): returning to refs/heads/develop</span><br><span class="line">22d3349 HEAD@&#123;2&#125;: rebase -i (start): checkout 22d3349</span><br><span class="line">f671986 HEAD@&#123;3&#125;: checkout: moving from master to develop</span><br><span class="line">22d3349 HEAD@&#123;4&#125;: checkout: moving from develop to master</span><br><span class="line">f671986 HEAD@&#123;5&#125;: checkout: moving from master to develop</span><br><span class="line">22d3349 HEAD@&#123;6&#125;: checkout: moving from rctf to master</span><br><span class="line">f671986 HEAD@&#123;7&#125;: commit: Revert</span><br><span class="line">f4d0f6d HEAD@&#123;8&#125;: commit: Flag</span><br><span class="line">22d3349 HEAD@&#123;9&#125;: checkout: moving from master to rctf</span><br><span class="line">22d3349 HEAD@&#123;10&#125;: commit (initial): Initial Commit</span><br></pre></td></tr></table></figure></p>
<p>还原到指定版本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard  f4d0f6d</span><br></pre></td></tr></table></figure></p>
<h3 id="ORIG-HEAD"><a href="#ORIG-HEAD" class="headerlink" title="ORIG_HEAD"></a>ORIG_HEAD</h3><p>在 <code>.git</code> 目录里除了 HEAD 档案之外，还有另一个叫做ORIG_HEAD的档案，当你在做一些比较危险的操作（例如像merge，rebase 或 reset之类的），Git 就会把HEAD的状态存放在这里，让你随时可以跳回危险动作之前的状态。</p>
<p>虽然 <code>git reflog</code> 指令也可以查到相关资讯，但 reflog 的资料比较杂一点，这个 ORIG_HEAD 会更方便的找到最近一次危险动作之前的SHA-1值。用下面这个命令可以查看危险操作日志，<code>-p</code> 参数后面，<code>-1</code> 表示上一条，<code>-2</code> 表示上两条<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log ORIG_HEAD -p -100</span><br></pre></td></tr></table></figure></p>
<p>输出类似如下的内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">commit f671986f9aaa4fc49d8f3eba916d7947dc9f7e46</span><br><span class="line">Author: xxxx &lt;xxx@example.com&gt;</span><br><span class="line">Date: Sun May 13 12:55:31 2018 +0800</span><br><span class="line">    Revert</span><br><span class="line">diff --git a/flag.txt b/flag.txt</span><br><span class="line">deleted file mode 100644</span><br><span class="line">index 82a7a33..0000000</span><br><span class="line">--- a/flag.txt</span><br><span class="line">+++ /dev/null</span><br><span class="line">@@ -1 +0,0 @@</span><br><span class="line">-xxx&#123;12345&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="可视化界面操作"><a href="#可视化界面操作" class="headerlink" title="可视化界面操作"></a>可视化界面操作</h3><p>我在 Windows 下使用 TortoiseGit，只要右键找到显示引用记录，就能找到所有的操作记录，然后选择想要的版本，重置过去就可以了。即便是现在这一步的重置操作选错了版本也没事，因为这个操作也被记录下来，你还是可以重置到正确的版本。</p>
<p><img src="/2018/07/31/TortoiseGit代码版本还原方法/1532997667136.png" alt=""></p>
<p>看到这张图，是不是一股暖流涌上心头，终于找回来了。</p>
<p><img src="/2018/07/31/TortoiseGit代码版本还原方法/1532997682242.png" alt=""></p>
<p>曾经尝试过用命令来操作，但是试了很久都没成功，只好放弃，改用 TortoiseGit 来操作。TortoiseGit 在 Windows 下几乎是最好用的 Git GUI 工具了。</p>
<p>自从使用了 Git，只要有 <code>commit</code> 过的代码，再也不担心会丢了，尽情的 <code>commit</code> 吧。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/26/Git-submodule用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BingcaiHuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BingcaiHuang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/26/Git-submodule用法/" itemprop="url">Git-submodule用法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-26T14:48:54+08:00">
                2018-07-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/TortoiseGit/" itemprop="url" rel="index">
                    <span itemprop="name">TortoiseGit</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/07/26/Git-submodule用法/" class="leancloud_visitors" data-flag-title="Git-submodule用法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>参考文章<a href="https://blog.csdn.net/zahuopuboss/article/details/51472842" target="_blank" rel="noopener">git的submodule功能详解</a></p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>项目的版本库在某些情况下需要引用其他版本库中的文件，例如有一套公用的代码库，可以被多个项目调用，这个公用代码库能直接放在某个项目的代码中，而是要独立为一个代码库，那么其他要调用公用的代码库该如何处理？分别把公用的代码库拷贝到各自的项目中会造成冗余，丢弃了公共代码库的维护历史，这些显示不是好的办法，现在要了解的git子模组(git submodule)就解决了这个问题。</p>
<p>Git 子模块功能允许你将一个Git仓库当作另外一个Git仓库的子目录。这允许你克隆另外一个仓库到你的项目中并且保持你的提交相对独立。</p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>首先需要两个版本库例如：<br>1) 一个公共的版本库(例如：libA.git)<br><a href="mailto:git@gitlab.szreach.com" target="_blank" rel="noopener">git@gitlab.szreach.com</a>:fengyang/liba.git</p>
<p>2) 一个引用公共版本库的主版本库(例如：super.git)<br><a href="mailto:git@gitlab.szreach.com" target="_blank" rel="noopener">git@gitlab.szreach.com</a>:fengyang/super.git</p>
<h2 id="TortoiseGit上git-submodule功能实现"><a href="#TortoiseGit上git-submodule功能实现" class="headerlink" title="TortoiseGit上git submodule功能实现"></a>TortoiseGit上git submodule功能实现</h2><h3 id="添加子模组的步骤"><a href="#添加子模组的步骤" class="headerlink" title="添加子模组的步骤"></a>添加子模组的步骤</h3><p>####第一步：使用submodule add…添加子模组<br>在需要作添加子模组的Git版本库中右击，选择“TortoiseGit-&gt;Submodule Add…”，在“Repository:”里面输入需要添加子模组的版本库路径，在“Path：”<br>中输入添加子模组存放的目录路径。如下图所示：</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588080598.png" alt=""></p>
<p>此时查看需要添加子模组的Git工作区的目录结构。在根目录下多了一个.gitmodules文件，并且公共代码库被克隆到lib/lib_a目录下。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588131524.png" alt=""></p>
<p>####第二步：查看.gitmodules的内容<br>.gitmodules的内容记录着含子模组存放的目录路径及子模组版本库的路径</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588172075.png" alt=""><br>注：此时工作区尚未提交，完成提交后，子模组才算正式完成在需要作添加子模组的Git版本库中创立。</p>
<p>注：此主版本库(super.git)就变成了一个包含子模组的版本库。</p>
<h3 id="克隆带子模组的版本库的步骤"><a href="#克隆带子模组的版本库的步骤" class="headerlink" title="克隆带子模组的版本库的步骤"></a>克隆带子模组的版本库的步骤</h3><p>克隆带子模组的git库，并不能自动将子模组的版本库克隆出来，对于只关心项目本身的数据，而不关心项目引用的外部项目数据的用户，这个功能非常好，数据没有冗余而且克隆的速度也很快。</p>
<h4 id="第一步：克隆super主版本库"><a href="#第一步：克隆super主版本库" class="headerlink" title="第一步：克隆super主版本库"></a>第一步：克隆super主版本库</h4><p>在工作区中克隆主主版本库后，会发现子模组的版本库并没有克隆，只有将存放子模组版本库的目录克隆下来了。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588235376.png" alt=""></p>
<p>存放子模组版本库的目录路径</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588265251.png" alt=""></p>
<h4 id="第二步：克隆子模组"><a href="#第二步：克隆子模组" class="headerlink" title="第二步：克隆子模组"></a>第二步：克隆子模组</h4><p>如果需要克隆出子模组形式引用的外部库，首先需要执行Submodule Update操作。</p>
<p>在需要作克隆子模组的Git工作区中右击，选择“TortoiseGit-&gt;Submodule Update…”,点击“OK”即可。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588301375.png" alt=""></p>
<p>执行Submodule Update…操作后就会把子模组的版本库克隆下来。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588313780.png" alt=""></p>
<h3 id="对主Git库工作区作commit、checkout、revert、pull、push等更改Git工作区内容的操作时，查看Submodule目录下内容的效果"><a href="#对主Git库工作区作commit、checkout、revert、pull、push等更改Git工作区内容的操作时，查看Submodule目录下内容的效果" class="headerlink" title="对主Git库工作区作commit、checkout、revert、pull、push等更改Git工作区内容的操作时，查看Submodule目录下内容的效果"></a>对主Git库工作区作commit、checkout、revert、pull、push等更改Git工作区内容的操作时，查看Submodule目录下内容的效果</h3><h4 id="1-对主Git库工作区作commit操作"><a href="#1-对主Git库工作区作commit操作" class="headerlink" title="1) 对主Git库工作区作commit操作"></a>1) 对主Git库工作区作commit操作</h4><p>当在主Git库工作区中变更到达一个适当状态时，我们需要将这些变更提交到Git库，作版本备份和跟踪。</p>
<p>方法：</p>
<p>在工作区内右击，选择“ Commit-&gt; “当前分支名称” ”，在Commit窗口中，选择需要提交的变更path，填写提交说明，点击“Ok”。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588398302.png" alt=""></p>
<p>结论：在主git工作区作commit操作，只是将主Git工作区的变更历史提交到主Git本地库中，对Submodule没有任何影响。</p>
<h4 id="对主Git库工作区作checkout操作"><a href="#对主Git库工作区作checkout操作" class="headerlink" title="对主Git库工作区作checkout操作"></a>对主Git库工作区作checkout操作</h4><p>当在主Git库工作区中想要切换到其他某个分支、某个tag、某个commit历史记录。</p>
<p>我们这里举个特殊的例子：</p>
<p>切换到某个commit历史记录(如在主版本库中提交子版本库的历史记录)</p>
<p>方法：</p>
<p>在Git工作区内的某目录上右击，选择“Swicht/Checkout…”在Swicht/Checkout…Checkout窗口中，在Switch to Commmit中列出需要切换的commit历史记录，在此列表中选择需要切换到的commit历史记录，以后点击“Ok”按钮。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588440810.png" alt=""></p>
<p><img src="/2018/07/26/Git-submodule用法/1532588447419.png" alt=""></p>
<p><img src="/2018/07/26/Git-submodule用法/1532588452662.png" alt=""></p>
<p>注：由于切换到的是在主版本库中提交子版本库的那条历史记录，因此子模组中状态也会改换，也需要在子模组中执行切换。</p>
<p>执行Submodule Update操作即可。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588463163.png" alt=""></p>
<h4 id="对主Git库工作区作revert操作"><a href="#对主Git库工作区作revert操作" class="headerlink" title="对主Git库工作区作revert操作"></a>对主Git库工作区作revert操作</h4><p>当在主Git库工作区中这次变更有错误时，就可以使用revert操作来撤销这次次操作。</p>
<p>方法：</p>
<p>在工作区内右击，选择“Revert”，在Revert窗口中，选择需要撤销的变更path，点击“Ok”。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588499678.png" alt=""></p>
<p><img src="/2018/07/26/Git-submodule用法/1532588505922.png" alt=""></p>
<p>结论：在主git工作区作revert操作，只是将主Git工作区某次的变更操作给撤销，此次操作之前的commit都会被保留，且对Submodule没有任何影响。</p>
<h4 id="对主Git库工作区作push操作"><a href="#对主Git库工作区作push操作" class="headerlink" title="对主Git库工作区作push操作"></a>对主Git库工作区作push操作</h4><p>当在主Git库工作区中将主Git本地库的数据推送到主Git远程库中。</p>
<p>方法：在工作区的目录上（不要在文件上）右击，选择“Git Sync…”</p>
<p>“Local Branch”，”Remote Branch”，“Remote URL”这3栏必须正确才能“推”数据。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588527148.png" alt=""></p>
<p>结论：在主git工作区作push操作，只是将主Git本地库的变更历史推送到到主Git远程库中，对Submodule没有任何影响。</p>
<h4 id="对主Git库工作区作pull操作"><a href="#对主Git库工作区作pull操作" class="headerlink" title="对主Git库工作区作pull操作"></a>对主Git库工作区作pull操作</h4><p>当在主Git库工作区中将主Git远程库的拉取到主Git本地库中。</p>
<p>方法：在工作区的目录上（不要在文件上）右击，选择“Git Sync…”</p>
<p>“Local Branch”，”Remote Branch”，“Remote URL”这3栏必须正确才能“拉”数据。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588582483.png" alt=""></p>
<p>结论：在主git工作区作pull操作，只是将主Git远程库的变更历史拉取到到主Git本地库中，对Submodule没有任何影响。</p>
<h3 id="对submodule下的内容进行修改后commit、push，对submodule目录作pull"><a href="#对submodule下的内容进行修改后commit、push，对submodule目录作pull" class="headerlink" title="对submodule下的内容进行修改后commit、push，对submodule目录作pull"></a>对submodule下的内容进行修改后commit、push，对submodule目录作pull</h3><p>在执行Submodule Update…操作更新出子模组后，都以某个具体的提交版本进行检出，进入子模组目录，会发现其处于非跟踪状态。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588613891.png" alt=""></p>
<p>显然这种情况下，如果修改lib/lib_a下的文件，提交就会丢失。下面介绍如何在检查的子模组中修改，以及如何更新子模组。</p>
<p>在子模组中切换到master分支(或者其他想要修改的分支)后在进行修改。</p>
<ul>
<li>切换到master分支，然后在工作区做一些改动。</li>
</ul>
<p><img src="/2018/07/26/Git-submodule用法/1532588630623.png" alt=""></p>
<ul>
<li>执行commit后，并且推送到子模组库中后。</li>
<li>回到主版本库中。</li>
</ul>
<p>在主版本库中查看状态，在主版本库中可以看到子模组已修改，包含了更新的提交。</p>
<ul>
<li>需要将修改提交在主版本库中进行推送。<br><img src="/2018/07/26/Git-submodule用法/1532588659308.png" alt=""></li>
</ul>
<h4 id="对submodule目录作pull"><a href="#对submodule目录作pull" class="headerlink" title="对submodule目录作pull"></a>对submodule目录作pull</h4><p>当子模组版本库中有新的提交历史记录，就需要做pull操作来更新。</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588709532.png" alt=""></p>
<p>注：对子模组库中做了pull操作，同时需要对调用子模组库的主版本库中也要做Pull操作。</p>
<p>如下图所示：<br><img src="/2018/07/26/Git-submodule用法/1532588723173.png" alt=""></p>
<p>注意：进入子模组目录，会发现其处于非跟踪状态。显然这种情况下，如果修改lib/lib_a下的文件，提交就会丢失。提示如下：</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588742276.png" alt=""></p>
<h3 id="移除Submodule"><a href="#移除Submodule" class="headerlink" title="移除Submodule"></a>移除Submodule</h3><p>第一步：用Delete(keep local) 将目录或文件命令从git的索引库中移除子模块目录<br>方法：</p>
<p>在工作区内目录或文件上右击，选择“Delete(keep local)”，在Delete窗口中，点击“Remove”。</p>
<p>Delete(keep local)把目录lib/从git的索引库中移除,但是对目录lib/本身并不进行任何操作。</p>
<p>因此需要彻底删除。</p>
<p>第二步：删除物理文件</p>
<p>第三步：删除.gitmodule文件</p>
<p>第四步：删除.git/config的submodule配置源文件</p>
<p>删除如下图所示红框的部门</p>
<p><img src="/2018/07/26/Git-submodule用法/1532588786127.png" alt=""></p>
<p>第五步：删除后，提交更改</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">BingcaiHuang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BingcaiHuang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("zB9W7fUpG8e9iQF9I018I0bj-gzGzoHsz", "RkIarEbWMsL4NVGQPKkJwzAi");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
