<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Qt,Model/View,QTableWidget," />










<meta name="description" content="QTableWidget单击选中取消事件 QTableWidget单击选中取消事件  前言很多情况下有这样的需求，当鼠标点击QTableWidget时，每次只能选中一行或者不选中，不允许选中多行。例如：当点击表格中时选中一行，同时打开所选中的这行的详细信息（另一个GUI控件），当点击表格之外，选中行取消高亮（取消选择），同时详细信息也消失。 说明1.QTableWidget时，选择行时，可以使用1">
<meta name="keywords" content="Qt,Model&#x2F;View,QTableWidget">
<meta property="og:type" content="article">
<meta property="og:title" content="QTableWidget单击选中取消事件">
<meta property="og:url" content="http://yoursite.com/2018/11/30/QTableWidget单击选中取消事件/index.html">
<meta property="og:site_name" content="BingcaiHuang&#39;s Blog">
<meta property="og:description" content="QTableWidget单击选中取消事件 QTableWidget单击选中取消事件  前言很多情况下有这样的需求，当鼠标点击QTableWidget时，每次只能选中一行或者不选中，不允许选中多行。例如：当点击表格中时选中一行，同时打开所选中的这行的详细信息（另一个GUI控件），当点击表格之外，选中行取消高亮（取消选择），同时详细信息也消失。 说明1.QTableWidget时，选择行时，可以使用1">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-11-30T03:46:53.781Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="QTableWidget单击选中取消事件">
<meta name="twitter:description" content="QTableWidget单击选中取消事件 QTableWidget单击选中取消事件  前言很多情况下有这样的需求，当鼠标点击QTableWidget时，每次只能选中一行或者不选中，不允许选中多行。例如：当点击表格中时选中一行，同时打开所选中的这行的详细信息（另一个GUI控件），当点击表格之外，选中行取消高亮（取消选择），同时详细信息也消失。 说明1.QTableWidget时，选择行时，可以使用1">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/11/30/QTableWidget单击选中取消事件/"/>





  <title>QTableWidget单击选中取消事件 | BingcaiHuang's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">BingcaiHuang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/30/QTableWidget单击选中取消事件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="BingcaiHuang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="BingcaiHuang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">QTableWidget单击选中取消事件</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-30T11:15:34+08:00">
                2018-11-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Qt-Model-View/" itemprop="url" rel="index">
                    <span itemprop="name">Qt - Model/View</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/11/30/QTableWidget单击选中取消事件/" class="leancloud_visitors" data-flag-title="QTableWidget单击选中取消事件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="QTableWidget单击选中取消事件"><a href="#QTableWidget单击选中取消事件" class="headerlink" title="QTableWidget单击选中取消事件"></a>QTableWidget单击选中取消事件</h2><blockquote>
<p><a href="https://blog.csdn.net/u010030181/article/details/52396591" target="_blank" rel="noopener">QTableWidget单击选中取消事件</a></p>
</blockquote>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>很多情况下有这样的需求，当鼠标点击QTableWidget时，每次只能选中一行或者不选中，不允许选中多行。例如：当点击表格中时选中一行，同时打开所选中的这行的详细信息（另一个GUI控件），当点击表格之外，选中行取消高亮（取消选择），同时详细信息也消失。</p>
<h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>1.QTableWidget时，选择行时，可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setSelectionBehavior(QAbstractItemView::SelectRows);</span><br></pre></td></tr></table></figure></p>
<p>2.QTableWidget选择多个节点时，单击节点之外是可以自动取消高亮行的，现在的问题是每次只能选择一行，QT文档说明如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">Constant</th>
<th style="text-align:left">Value</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">QAbstractItemView::SingleSelection</td>
<td style="text-align:left">1</td>
<td style="text-align:left">When the user selects an item, any already-selected item becomes unselected, and the user cannot unselect the selected item by clicking on it.</td>
</tr>
<tr>
<td style="text-align:left">QAbstractItemView::ContiguousSelection</td>
<td style="text-align:left">4</td>
<td style="text-align:left">When the user selects an item in the usual way, the selection is cleared and the new item selected. However, if the user presses the Shift key while clicking on an item, all items between the current item and the clicked item are selected or unselected, depending on the state of the clicked item.</td>
</tr>
<tr>
<td style="text-align:left">QAbstractItemView::ExtendedSelection</td>
<td style="text-align:left">3</td>
<td style="text-align:left">When the user selects an item in the usual way, the selection is cleared and the new item selected. However, if the user presses the Ctrl key when clicking on an item, the clicked item gets toggled and all other items are left untouched. If the user presses the Shift key while clicking on an item, all items between the current item and the clicked item are selected or unselected, depending on the state of the clicked item. Multiple items can be selected by dragging the mouse over them.</td>
</tr>
<tr>
<td style="text-align:left">QAbstractItemView::MultiSelection</td>
<td style="text-align:left">2</td>
<td style="text-align:left">When the user selects an item in the usual way, the selection status of that item is toggled and the other items are left alone. Multiple items can be toggled by dragging the mouse over them.</td>
</tr>
<tr>
<td style="text-align:left">QAbstractItemView::NoSelection</td>
<td style="text-align:left">0</td>
<td style="text-align:left">Items cannot be selected.</td>
</tr>
</tbody>
</table>
<p>红色字体可以看出，SingleSelection模式时，再次单击选中的行，是不会取消选择的，其实，还有一个没有说明：就是单击表格之外，其实也不会取消当前的选择。</p>
<p>当表格中有多行数据时，其实可以点击其他行，是可以切换的，最大的问题是，当表格只有一行数据时，如果你选中了该行后，那么无论点击哪里，该选择都取消不了，这会带来一系列的问题……</p>
<p>那么如何能实现每次只选择一行，却可以在点击表格之外，可以取消当前的选择行？</p>
<h3 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h3><p>通过继承，重写鼠标按下事件，在按下的时候，判断该坐标点是否在表格中，进行取消/选择高亮是可以实现的，但是，不太喜欢这样做……</p>
<p>现在的方法如下，无需继承，只需要一个槽行数即可。<br>1.首先我们选择使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setSelectionBehavior(QAbstractItemView::SelectRows)//设置行选择。</span><br><span class="line"></span><br><span class="line">setSelectionMode(QAbstractItemView::ContiguousSelection);//设置多行选择。</span><br></pre></td></tr></table></figure></p>
<p>2.使该表的信号itemSelectionChanged与某个槽关联。<br>3.在槽中进行处理，使其看起来像单行选择的效果。具体说明看代码<br>.h文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#ifndef CTESTGUI_H</span><br><span class="line"></span><br><span class="line">#define CTESTGUI_H</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">#include &lt;QWidget&gt;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">class QTableWidget;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">class CTestGui : public QWidget</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">    CTestGui(QWidget *parent =NULL);</span><br><span class="line"></span><br><span class="line">    ~CTestGui();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line"></span><br><span class="line">    void initLayout();</span><br><span class="line"></span><br><span class="line">    void initTab();</span><br><span class="line"></span><br><span class="line">    void initTabDatas();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">public slots:</span><br><span class="line"></span><br><span class="line">    void onItemSelectionChanged();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line"></span><br><span class="line">    QTableWidget* m_tab;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">#endif // CTESTGUI_H</span><br></pre></td></tr></table></figure></p>
<p>cpp文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;QVBoxLayout&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;QTableWidget&gt;</span><br><span class="line"></span><br><span class="line">#include &lt;QHeaderView&gt;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">#include &quot;ctestgui.h&quot;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">CTestGui::CTestGui(QWidget *parent)</span><br><span class="line"></span><br><span class="line">    : QWidget(parent)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    initLayout();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">CTestGui::~CTestGui()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">void CTestGui::initLayout()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    initTab();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    QVBoxLayout* layoyt = new QVBoxLayout(this);</span><br><span class="line"></span><br><span class="line">    layoyt-&gt;addWidget(m_tab);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">void CTestGui::initTab()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    m_tab = new QTableWidget(this);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setContentsMargins(0, 0, 0, 0);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setColumnCount(4);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    m_tab-&gt;horizontalHeader()-&gt;setHighlightSections(false);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;horizontalHeader()-&gt;setStretchLastSection(true);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setFocusPolicy(Qt::NoFocus);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setSelectionBehavior(QAbstractItemView::SelectRows);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setSelectionMode(QAbstractItemView::ContiguousSelection);  //上面两句说明可以选择多行</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    //m_tab-&gt;setEditTriggers(QAbstractItemView::NoEditTriggers);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    QStringList tabHeaders;</span><br><span class="line"></span><br><span class="line">    tabHeaders &lt;&lt; tr(&quot;Item1&quot;) &lt;&lt; tr(&quot;Item2&quot;) &lt;&lt; tr(&quot;Item3&quot;) &lt;&lt; tr(&quot;Item4&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setHorizontalHeaderLabels(tabHeaders);//设置表头</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    initTabDatas();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    connect(m_tab, &amp;QTableWidget::itemSelectionChanged,this, &amp;CTestGui::onItemSelectionChanged);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">void CTestGui::initTabDatas()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    //填充数据</span><br><span class="line"></span><br><span class="line">    int row = 0;</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;insertRow(row);//插入新行</span><br><span class="line"></span><br><span class="line">    QTableWidgetItem *newItem1 =new QTableWidgetItem(&quot;This is A1&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 0,newItem1);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    QTableWidgetItem *newItem2 =new QTableWidgetItem(&quot;This is B1&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 1,newItem2);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    QTableWidgetItem *newItem3 =new QTableWidgetItem(&quot;This is C1&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 2,newItem3);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    QTableWidgetItem *newItem4 =new QTableWidgetItem(&quot;This is D1&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 3,newItem4);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    m_tab-&gt;insertRow(++row);//插入新行</span><br><span class="line"></span><br><span class="line">    newItem1 = new QTableWidgetItem(&quot;This is A2&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 0,newItem1);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem2 = new QTableWidgetItem(&quot;This is B2&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 1,newItem2);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem3 = new QTableWidgetItem(&quot;This is C2&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 2,newItem3);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem4 = new QTableWidgetItem(&quot;This is D2&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 3,newItem4);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    m_tab-&gt;insertRow(++row);//插入新行</span><br><span class="line"></span><br><span class="line">    newItem1 = new QTableWidgetItem(&quot;This is A3&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 0,newItem1);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem2 = new QTableWidgetItem(&quot;This is B3&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 1,newItem2);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem3 = new QTableWidgetItem(&quot;This is C3&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 2,newItem3);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem4 = new QTableWidgetItem(&quot;This is D3&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 3,newItem4);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    m_tab-&gt;insertRow(++row);//插入新行</span><br><span class="line"></span><br><span class="line">    newItem1 = new QTableWidgetItem(&quot;This is A4&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 0,newItem1);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem2 = new QTableWidgetItem(&quot;This is B4&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 1,newItem2);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem3 = new QTableWidgetItem(&quot;This is C4&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 2,newItem3);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    newItem4 = new QTableWidgetItem(&quot;This is D4&quot;);</span><br><span class="line"></span><br><span class="line">    m_tab-&gt;setItem(row, 3,newItem4);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">/************************************************************************/</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"></span><br><span class="line">    多选行变成单行效果的过程：</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">1、当选择的Item发生改变时，会触发itemSelectionChanged信号,进而进入到onItemSelectionChanged()函数中，</span><br><span class="line"></span><br><span class="line">只需在该函数中控制即可</span><br><span class="line"></span><br><span class="line">2、由于我们可能选择多行，所以我们必须先取消所有选择行，再对最后一行进行高亮（选择），取消高亮（选择）的时候，又会触发该函数，</span><br><span class="line"></span><br><span class="line">造成递归触发，为了避免这个现象，在取消高亮的时候，先disconnect该信号与槽的连接，等取消好后，再高亮最后一行后，再恢复该信号。</span><br><span class="line"></span><br><span class="line">注：由于每个人创建的表格的列数并不一样，所以我们只需要找到最后一个选择的item,并且高亮（选择）该item,该item所在的行的其他items</span><br><span class="line"></span><br><span class="line">也会高亮，如果再提高一点效率，我们可以判断是选择了单行（不做处理），还是选择了多行（先取消，再选择最后一行）,判断是否选择单行，</span><br><span class="line"></span><br><span class="line">只需要在选择的selectedItems()的中的条目是否是表格的列数。如果是则说明是选择单行，如果大于表格的列数，则说明是多行。</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">/************************************************************************/</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">//SLOT</span><br><span class="line"></span><br><span class="line">void CTestGui::onItemSelectionChanged()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    QList&lt;QTableWidgetItem*&gt;itemList = m_tab-&gt;selectedItems();</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    if (!itemList.isEmpty())</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">       int row;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line"></span><br><span class="line">       if (itemList.size() ==m_tab-&gt;columnCount()) //表明选中的是一行</span><br><span class="line"></span><br><span class="line">       &#123;</span><br><span class="line"></span><br><span class="line">           //</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       else   //选中了多行，要进行处理，使其最终看起来是选中了一行</span><br><span class="line"></span><br><span class="line">       &#123;</span><br><span class="line"></span><br><span class="line">           bool disabled = m_tab-&gt;disconnect(SIGNAL(itemSelectionChanged()));//此处一定要disconnect该信号，否则会产生递归</span><br><span class="line"></span><br><span class="line">           if (disabled)</span><br><span class="line"></span><br><span class="line">           &#123;</span><br><span class="line"></span><br><span class="line">              QTableWidgetItem*item = itemList[itemList.size() - 1];</span><br><span class="line"></span><br><span class="line">              row = m_tab-&gt;row(item);</span><br><span class="line"></span><br><span class="line">              m_tab-&gt;clearSelection();</span><br><span class="line"></span><br><span class="line">              m_tab-&gt;setCurrentItem(item);</span><br><span class="line"></span><br><span class="line">              //m_tab-&gt;setCurrentCell(row, 0);</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">              connect(m_tab, &amp;QTableWidget::itemSelectionChanged,this, &amp;CTestGui::onItemSelectionChanged);</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       //do something</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    else</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">       //do other something</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Qt/" rel="tag"># Qt</a>
          
            <a href="/tags/Model-View/" rel="tag"># Model/View</a>
          
            <a href="/tags/QTableWidget/" rel="tag"># QTableWidget</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/11/30/Qt-学习之路-2（47）：视图选择/" rel="next" title="Qt 学习之路 2（47）：视图选择">
                <i class="fa fa-chevron-left"></i> Qt 学习之路 2（47）：视图选择
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">BingcaiHuang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">36</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#QTableWidget单击选中取消事件"><span class="nav-number">1.</span> <span class="nav-text">QTableWidget单击选中取消事件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#前言"><span class="nav-number">1.1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#说明"><span class="nav-number">1.2.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解决方法"><span class="nav-number">1.3.</span> <span class="nav-text">解决方法</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">BingcaiHuang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("zB9W7fUpG8e9iQF9I018I0bj-gzGzoHsz", "RkIarEbWMsL4NVGQPKkJwzAi");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
